fullnameOverride: minio
nameOverride: minio

mode: standalone

minioAPIPort: "9000"
minioConsolePort: "9001"

rootUser: {{ .Values.minio_access_key }}
rootPassword: {{ .Values.minio_secret_key }}

configPathmc: "/etc/minio/mc/"
mountPath: "/export"

tls:
  enabled: false
  certSecret: ""
  publicCrt: public.crt
  privateKey: private.key

trustedCertsSecret: ""

persistence:
  enabled: true
  storageClass: {{ requiredEnv "STORAGE_CLASS_NAME" | quote }}
  size: 5Gi
  accessMode: ReadWriteOnce

ingress:
  enabled: false

environment:
    MINIO_CORS_ALLOW_ORIGIN: "*"
    MINIO_BROWSER_REFERRER_POLICY: "no-referrer-when-downgrade"
    MINIO_BROWSER_CONTENT_SECURITY_POLICY: "default-src * 'unsafe-inline' 'unsafe-eval'; frame-ancestors * 'self' file://* http://localhost:* http://127.0.0.1:* http://0.0.0.0:*"
    MINIO_BROWSER_XSS_PROTECTION: "1; mode=block"

consoleIngress:
  enabled: true
  ingressClassName: nginx
  annotations:
    cert-manager.io/cluster-issuer: selfsigned-clusterissuer
    nginx.ingress.kubernetes.io/auth-signin: "https://kdlapp.{{ requiredEnv "DOMAIN" }}/oauth2/start?rd=https://minio-console.{{ requiredEnv "DOMAIN" }}"
  path: /
  hosts:
    - minio-console.{{ requiredEnv "DOMAIN" }}
  tls:
    - secretName: minio-console-tls
      hosts:
      - minio-console.{{ requiredEnv "DOMAIN" }}

resources:
  requests:
    memory: 1Gi

users: []

## OpenID Identity Management
## The following section documents environment variables for enabling external identity management using an OpenID Connect (OIDC)-compatible provider.
## See https://min.io/docs/minio/linux/operations/external-iam/configure-openid-external-identity-management.html for a tutorial on using these variables.
oidc:
  enabled: true
  configUrl: "https://keycloak.{{ requiredEnv "DOMAIN" }}/realms/kdl/.well-known/openid-configuration"
  clientId: "minio"
  clientSecret: "minio123456"
  claimName: "policy"
  scopes: "openid email"
  redirectUri: "https://minio-console.{{ requiredEnv "DOMAIN" }}/oauth_callback"
  displayName: "Your VASS Account"
  rolePolicy: "readwrite"

certsPath: "/certs/"

extraVolumes:
  - name: cert
    secret:
      secretName: keycloak-tls
      defaultMode: 420
      items:
      - key: ca.crt
        path: ca.crt

extraVolumeMounts:
  - name: cert
    mountPath: /certs/CAs/ca.crt
    readOnly: true
    subPath: ca.crt
